import{c as X,r as g,j as c,G as Q,D as U,T as A,g as N,s as tt}from"./index-7UUcHPJu.js";import{R as et}from"./SplitView-BhmQhCZF.js";const nt=X("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]),it=X("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),st=X("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),ct=({room:e,assets:j=[],selectedAsset:p,onAssetSelect:P,onAssetUpdate:v,onAssetDelete:C,editMode:Y="view",showGrid:W=!0})=>{const b=g.useRef(null),B=g.useRef(null),[f,M]=g.useState(30),[y,H]=g.useState({x:0,y:0}),[O,D]=g.useState(!1),[x,m]=g.useState(null),[u,$]=g.useState(null),k=(n,t)=>{const i=b.current;if(!i)return{x:0,y:0};const o=i.width/2,h=i.height/2;return{x:o+n*f+y.x,y:h+t*f+y.y}},V=(n,t)=>{const i=b.current;if(!i)return{x:0,z:0};const o=i.width/2,h=i.height/2;return{x:(n-o-y.x)/f,z:(t-h-y.y)/f}},E=()=>{const n=b.current;if(!n)return;const t=n.getContext("2d"),i=n.width,o=n.height;if(t.clearRect(0,0,i,o),W){t.strokeStyle="#e5e7eb",t.lineWidth=1,t.setLineDash([2,2]);const a=1*f;for(let s=y.x%a;s<i;s+=a)t.beginPath(),t.moveTo(s,0),t.lineTo(s,o),t.stroke();for(let s=y.y%a;s<o;s+=a)t.beginPath(),t.moveTo(0,s),t.lineTo(i,s),t.stroke();t.setLineDash([])}if(e!=null&&e.walls)t.strokeStyle="#374151",t.lineWidth=3,t.fillStyle="#f3f4f6",t.beginPath(),e.walls.forEach((l,a)=>{const s=k(l.start[0],l.start[2]),r=k(l.end[0],l.end[2]);a===0&&t.moveTo(s.x,s.y),t.lineTo(r.x,r.y)}),t.closePath(),t.fill(),t.stroke();else if(e!=null&&e.width&&(e!=null&&e.depth)){const l=k(0,0),a=e.width*f,s=e.depth*f;t.fillStyle="#ffffff",t.fillRect(l.x-a/2,l.y-s/2,a,s);const r=.2,d=e.width/2,Z=e.depth/2;t.fillStyle="#e5e7eb",t.strokeStyle="#374151",t.lineWidth=1;const w=(z,S,I,L)=>{const T=k(z,S),R=I*f,K=L*f;t.beginPath(),t.rect(T.x-R/2,T.y-K/2,R,K),t.fill(),t.stroke()};w(0,-Z,e.width,r),w(-d,0,r,e.depth),w(d,0,r,e.depth)}j.forEach(l=>{const a=N(l.type||"default"),s=k(l.position[0],l.position[2]),r=a.width*f,d=a.depth*f;if(l.id===(p==null?void 0:p.id))t.fillStyle="#3b82f6",t.globalAlpha=.8;else if(l.id===(u==null?void 0:u.id))t.fillStyle="#60a5fa",t.globalAlpha=.9;else{switch(l.category){case"Møbler":t.fillStyle="#8b7355";break;case"IT":t.fillStyle="#4a5568";break;case"Kjøkken":t.fillStyle="#718096";break;default:t.fillStyle="#9ca3af"}t.globalAlpha=1}t.save(),t.translate(s.x,s.y),l.rotation&&l.rotation[1]&&t.rotate(l.rotation[1]),t.fillRect(-r/2,-d/2,r,d),t.strokeStyle="#1f2937",t.lineWidth=1,t.strokeRect(-r/2,-d/2,r,d),t.fillStyle="#ffffff",t.font="10px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillText(l.name,0,0),t.restore(),t.globalAlpha=1}),e!=null&&e.name&&(t.fillStyle="#1f2937",t.font="bold 14px sans-serif",t.textAlign="left",t.fillText(e.name,10,25));const h=f;t.strokeStyle="#6b7280",t.lineWidth=2,t.beginPath(),t.moveTo(i-100,o-30),t.lineTo(i-100+h,o-30),t.stroke(),t.fillStyle="#6b7280",t.font="10px sans-serif",t.textAlign="center",t.fillText("1m",i-100+h/2,o-15)},G=n=>{const t=b.current.getBoundingClientRect(),i=n.clientX-t.left,o=n.clientY-t.top,h=V(i,o),l=j.find(a=>{const s=N(a.type||"default"),r=Math.abs(h.x-a.position[0]),d=Math.abs(h.z-a.position[2]);return r<s.width/2&&d<s.depth/2});l?(P==null||P(l),Y==="move"&&(D(!0),m({x:i,y:o,asset:l}))):(n.button===1||n.shiftKey)&&(D(!0),m({x:i,y:o,pan:!0}))},_=n=>{const t=b.current.getBoundingClientRect(),i=n.clientX-t.left,o=n.clientY-t.top,h=V(i,o),l=j.find(a=>{const s=N(a.type||"default"),r=Math.abs(h.x-a.position[0]),d=Math.abs(h.z-a.position[2]);return r<s.width/2&&d<s.depth/2});if($(l),O&&x){if(x.pan)H({x:y.x+(i-x.x),y:y.y+(o-x.y)}),m({...x,x:i,y:o});else if(x.asset){let a=h.x,s=h.z;if(e!=null&&e.width&&(e!=null&&e.depth)){const d=N(x.asset.type||"default"),Z=x.asset.rotation?x.asset.rotation[1]:0,w=Math.round(Math.abs(Z)/(Math.PI/2))%2===1,z=w?d.depth:d.width,S=w?d.width:d.depth,I=-e.width/2+z/2+.1,L=e.width/2-z/2-.1,T=-e.depth/2+S/2+.1,R=e.depth/2-S/2-.1;a=Math.max(I,Math.min(L,a)),s=Math.max(T,Math.min(R,s))}const r=tt([a,0,s]);v==null||v(x.asset.id,{position:r})}}},F=()=>{D(!1),m(null)},q=n=>{n.preventDefault();const t=n.deltaY>0?.9:1.1;M(i=>Math.max(10,Math.min(200,i*t)))};g.useEffect(()=>{const n=()=>{const t=B.current,i=b.current;t&&i&&(i.width=t.clientWidth,i.height=t.clientHeight,E())};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),g.useEffect(()=>{E()},[e,j,f,y,W,p,u]);const J=()=>{const n=b.current,t=document.createElement("a");t.download=`${(e==null?void 0:e.name)||"room"}_2d.png`,t.href=n.toDataURL(),t.click()};return c.jsxs("div",{className:"relative w-full h-full bg-gray-50",ref:B,children:[c.jsxs("div",{className:"absolute top-4 left-4 z-10 bg-white rounded-lg shadow-lg p-2 flex gap-2",children:[c.jsx("button",{onClick:()=>M(n=>Math.min(200,n*1.2)),className:"p-2 hover:bg-gray-100 rounded",title:"Zoom inn",children:c.jsx(it,{size:20})}),c.jsx("button",{onClick:()=>M(n=>Math.max(10,n*.8)),className:"p-2 hover:bg-gray-100 rounded",title:"Zoom ut",children:c.jsx(st,{size:20})}),c.jsx("button",{onClick:()=>{M(50),H({x:0,y:0})},className:"p-2 hover:bg-gray-100 rounded",title:"Tilbakestill visning",children:c.jsx(nt,{size:20})}),c.jsx("div",{className:"w-px bg-gray-200"}),c.jsx("button",{onClick:()=>E(),className:`p-2 rounded ${W?"bg-blue-100":"hover:bg-gray-100"}`,title:"Vis rutenett",children:c.jsx(Q,{size:20})}),c.jsx("button",{onClick:J,className:"p-2 hover:bg-gray-100 rounded",title:"Eksporter bilde",children:c.jsx(U,{size:20})})]}),Y!=="view"&&p&&c.jsxs("div",{className:"absolute top-4 right-4 z-10 bg-white rounded-lg shadow-lg p-2 flex gap-2",children:[c.jsx("button",{onClick:()=>{var n;return v==null?void 0:v(p.id,{rotation:[0,(((n=p.rotation)==null?void 0:n[1])||0)+Math.PI/4,0]})},className:"p-2 hover:bg-gray-100 rounded",title:"Roter",children:c.jsx(et,{size:20})}),c.jsx("button",{onClick:()=>C==null?void 0:C(p.id),className:"p-2 hover:bg-red-100 rounded text-red-600",title:"Slett",children:c.jsx(A,{size:20})})]}),u&&c.jsxs("div",{className:"absolute bottom-4 left-4 z-10 bg-white rounded-lg shadow-lg p-3",children:[c.jsx("div",{className:"text-sm font-medium",children:u.name}),c.jsx("div",{className:"text-xs text-gray-600",children:u.category}),c.jsxs("div",{className:"text-xs text-gray-500",children:["Posisjon: (",u.position[0].toFixed(1),", ",u.position[2].toFixed(1),")"]})]}),c.jsx("canvas",{ref:b,className:"w-full h-full cursor-crosshair",onMouseDown:G,onMouseMove:_,onMouseUp:F,onMouseLeave:F,onWheel:q,style:{cursor:O?"grabbing":u?"pointer":"crosshair"}})]})};export{ct as default};
